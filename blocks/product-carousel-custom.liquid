{% comment %}
  Group carousel (block) — vGCB-1.1.1
  - 用在任意 section 里，作为容器横向滑动内部子 block
  - 每一个「子 block」就是一个 slide（例如 Product card）
  - 修正：schema 中增加 blocks，使该 block 可以包含子 block
{% endcomment %}

{%- capture children -%}
  {% content_for 'blocks' %}
{%- endcapture -%}

{%- assign has_children = children | strip | size -%}

<div
  class="group-carousel-block"
  style="
    --gcb-slide-width: {{ block.settings.slide_width }}px;
    --gcb-gap: {{ block.settings.columns_gap }}px;
  "
  {{ block.shopify_attributes }}
>
  {%- if block.settings.show_heading and block.settings.heading != blank -%}
    <div class="group-carousel-block__header">
      <h3 class="group-carousel-block__title">
        {{ block.settings.heading }}
      </h3>
    </div>
  {%- endif -%}

  <div class="group-carousel-block__viewport">
    <div class="group-carousel-block__track">
      {%- if has_children > 0 -%}
        {{ children }}
      {%- else -%}
        <div class="group-carousel-block__empty">
          <p>Add blocks inside this carousel.</p>
        </div>
      {%- endif -%}
    </div>
  </div>
</div>

{% style %}
  .group-carousel-block {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    width: 100%;
  }

  .group-carousel-block__title {
    margin: 0;
  }

  .group-carousel-block__viewport {
    width: 100%;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;
  }

  .group-carousel-block__track {
    display: flex;
    gap: var(--gcb-gap, 16px);
    padding-block: 0.25rem;
    min-width: 100%;
  }

  /* 关键：把每个子 block 当成一个 slide */
  .group-carousel-block__track > * {
    flex: 0 0 min(var(--gcb-slide-width, 300px), 100%);
    min-width: min(var(--gcb-slide-width, 300px), 100%);
    scroll-snap-align: start;
  }

  .group-carousel-block__empty {
    opacity: .6;
  }

  @media (max-width: 749px) {
    .group-carousel-block__track > * {
      flex-basis: 80%;
      min-width: 80%;
    }
  }
{% endstyle %}

{% schema %}
{
  "name": "Group carousel (block)",

  "blocks": [
    {
      "type": "@theme"
    },
    {
      "type": "@app"
    },
    {
      "type": "_divider"
    }
  ],

  "settings": [
    {
      "type": "checkbox",
      "id": "show_heading",
      "label": "Show heading",
      "default": false
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Group carousel",
      "placeholder": "Heading"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "slide_width",
      "label": "Slide width",
      "min": 150,
      "max": 600,
      "step": 10,
      "unit": "px",
      "default": 260
    },
    {
      "type": "range",
      "id": "columns_gap",
      "label": "Horizontal gap",
      "min": 0,
      "max": 64,
      "step": 2,
      "unit": "px",
      "default": 16
    }
  ]
}
{% endschema %}
