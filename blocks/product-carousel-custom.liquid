{%- comment -%}
  Product carousel block — vBPC-1.2.1
  - 手动选择最多 8 个产品
  - 在 block 内横向滑动展示
  - 复用主题内置 _product-card 卡片（和 Recommended products 一致）
{%- endcomment -%}

{%- if block.settings.product_1
  or block.settings.product_2
  or block.settings.product_3
  or block.settings.product_4
  or block.settings.product_5
  or block.settings.product_6
  or block.settings.product_7
  or block.settings.product_8
-%}
  <div
    class="block-product-carousel"
    style="
      --bpc-slide-width: {{ block.settings.slide_width }}px;
      --bpc-gap: {{ block.settings.columns_gap }}px;
    "
    {{ block.shopify_attributes }}
  >
    {%- if block.settings.show_heading and block.settings.heading != blank -%}
      <div class="block-product-carousel__heading">
        <h3 class="block-product-carousel__title">
          {{ block.settings.heading }}
        </h3>
      </div>
    {%- endif -%}

    <div class="block-product-carousel__viewport">
      <div class="block-product-carousel__track">
        {%- assign p = block.settings.product_1 -%}
        {%- if p -%}
          <div class="block-product-carousel__item">
            {%- # theme-check-disable UniqueStaticBlockId -%}
              {%- content_for 'block',
                type: '_product-card',
                id: 'static-product-card',
                closest.product: p
              -%}
            {%- # theme-check-enable UniqueStaticBlockId -%}
          </div>
        {%- endif -%}

        {%- assign p = block.settings.product_2 -%}
        {%- if p -%}
          <div class="block-product-carousel__item">
            {%- # theme-check-disable UniqueStaticBlockId -%}
              {%- content_for 'block',
                type: '_product-card',
                id: 'static-product-card',
                closest.product: p
              -%}
            {%- # theme-check-enable UniqueStaticBlockId -%}
          </div>
        {%- endif -%}

        {%- assign p = block.settings.product_3 -%}
        {%- if p -%}
          <div class="block-product-carousel__item">
            {%- # theme-check-disable UniqueStaticBlockId -%}
              {%- content_for 'block',
                type: '_product-card',
                id: 'static-product-card',
                closest.product: p
              -%}
            {%- # theme-check-enable UniqueStaticBlockId -%}
          </div>
        {%- endif -%}

        {%- assign p = block.settings.product_4 -%}
        {%- if p -%}
          <div class="block-product-carousel__item">
            {%- # theme-check-disable UniqueStaticBlockId -%}
              {%- content_for 'block',
                type: '_product-card',
                id: 'static-product-card',
                closest.product: p
              -%}
            {%- # theme-check-enable UniqueStaticBlockId -%}
          </div>
        {%- endif -%}

        {%- assign p = block.settings.product_5 -%}
        {%- if p -%}
          <div class="block-product-carousel__item">
            {%- # theme-check-disable UniqueStaticBlockId -%}
              {%- content_for 'block',
                type: '_product-card',
                id: 'static-product-card',
                closest.product: p
              -%}
            {%- # theme-check-enable UniqueStaticBlockId -%}
          </div>
        {%- endif -%}

        {%- assign p = block.settings.product_6 -%}
        {%- if p -%}
          <div class="block-product-carousel__item">
            {%- # theme-check-disable UniqueStaticBlockId -%}
              {%- content_for 'block',
                type: '_product-card',
                id: 'static-product-card',
                closest.product: p
              -%}
            {%- # theme-check-enable UniqueStaticBlockId -%}
          </div>
        {%- endif -%}

        {%- assign p = block.settings.product_7 -%}
        {%- if p -%}
          <div class="block-product-carousel__item">
            {%- # theme-check-disable UniqueStaticBlockId -%}
              {%- content_for 'block',
                type: '_product-card',
                id: 'static-product-card',
                closest.product: p
              -%}
            {%- # theme-check-enable UniqueStaticBlockId -%}
          </div>
        {%- endif -%}

        {%- assign p = block.settings.product_8 -%}
        {%- if p -%}
          <div class="block-product-carousel__item">
            {%- # theme-check-disable UniqueStaticBlockId -%}
              {%- content_for 'block',
                type: '_product-card',
                id: 'static-product-card',
                closest.product: p
              -%}
            {%- # theme-check-enable UniqueStaticBlockId -%}
          </div>
        {%- endif -%}
      </div>
    </div>
  </div>
{%- else -%}
  <div class="block-product-carousel block-product-carousel--empty" {{ block.shopify_attributes }}>
    <p style="opacity:.6;">Select products in block settings.</p>
  </div>
{%- endif -%}

{% style %}
  .block-product-carousel {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .block-product-carousel__title {
    margin: 0;
  }

  .block-product-carousel__viewport {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scroll-snap-type: x mandatory;
  }

  .block-product-carousel__track {
    display: flex;
    gap: var(--bpc-gap, 16px);
    padding-block: 0.25rem;
  }

  .block-product-carousel__item {
    flex: 0 0 var(--bpc-slide-width, 260px);
    min-width: var(--bpc-slide-width, 260px);
    scroll-snap-align: start;
  }

  .block-product-carousel--empty {
    opacity: .7;
  }

  @media (max-width: 749px) {
    .block-product-carousel__item {
      flex-basis: 80%;
      min-width: 80%;
    }
  }
{% endstyle %}

{% schema %}
{
  "name": "Product carousel custom",
  "settings": [
    {
      "type": "header",
      "content": "Products"
    },
    {
      "type": "product",
      "id": "product_1",
      "label": "Product 1"
    },
    {
      "type": "product",
      "id": "product_2",
      "label": "Product 2"
    },
    {
      "type": "product",
      "id": "product_3",
      "label": "Product 3"
    },
    {
      "type": "product",
      "id": "product_4",
      "label": "Product 4"
    },
    {
      "type": "product",
      "id": "product_5",
      "label": "Product 5"
    },
    {
      "type": "product",
      "id": "product_6",
      "label": "Product 6"
    },
    {
      "type": "product",
      "id": "product_7",
      "label": "Product 7"
    },
    {
      "type": "product",
      "id": "product_8",
      "label": "Product 8"
    },
    {
      "type": "header",
      "content": "Heading"
    },
    {
      "type": "checkbox",
      "id": "show_heading",
      "label": "Show heading",
      "default": false
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured products",
      "placeholder": "Heading"
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "slide_width",
      "label": "Slide width",
      "min": 150,
      "max": 600,
      "step": 10,
      "unit": "px",
      "default": 260
    },
    {
      "type": "range",
      "id": "columns_gap",
      "label": "Horizontal gap",
      "min": 0,
      "max": 64,
      "step": 2,
      "unit": "px",
      "default": 16
    }
  ],
  "presets": [
    {
      "name": "Product carousel custom"
    }
  ]
}
{% endschema %}
