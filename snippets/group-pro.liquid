{%- doc -%}
  Group Pro block — vGP-1.2.0
  基于 group-block，增加：
    - position_mode: static / relative / absolute
    - position_* 偏移 + z-index
    - absolute_size_enabled + absolute_width_mode + absolute_width_custom + absolute_aspect_ratio
    - outer_glow_enabled + outer_glow_color + outer_glow_blur + outer_glow_spread
{%- enddoc -%}

{%- assign position_mode = settings.position_mode | default: 'static' -%}

{%- capture pro_position_style -%}
  {%- if position_mode == 'absolute' -%}
    position: absolute;
    top: {{ settings.position_top | default: 0 }}px;
    left: {{ settings.position_left | default: 0 }}px;
    {%- if settings.position_right != blank and settings.position_right != 0 -%}
      right: {{ settings.position_right }}px;
    {%- endif -%}
    {%- if settings.position_bottom != blank and settings.position_bottom != 0 -%}
      bottom: {{ settings.position_bottom }}px;
    {%- endif -%}
    z-index: {{ settings.position_z_index | default: 1 }};
  {%- elsif position_mode == 'relative' -%}
    position: relative;
    z-index: {{ settings.position_z_index | default: 1 }};
  {%- endif -%}
{%- endcapture -%}

{%- capture pro_size_style -%}
  {%- if settings.absolute_size_enabled and position_mode == 'absolute' -%}
    {%- case settings.absolute_width_mode -%}
      {%- when 'fill' -%}
        width: 100%;
      {%- when 'custom' -%}
        width: {{ settings.absolute_width_custom | default: 60 }}%;
      {%- else -%}
        {# fit: 不额外设置 width，沿用默认 #}
    {%- endcase -%}

    {%- case settings.absolute_aspect_ratio -%}
      {%- when '1_1' -%}
        aspect-ratio: 1 / 1;
      {%- when '4_3' -%}
        aspect-ratio: 4 / 3;
      {%- when '3_4' -%}
        aspect-ratio: 3 / 4;
      {%- when '16_9' -%}
        aspect-ratio: 16 / 9;
      {%- when '9_16' -%}
        aspect-ratio: 9 / 16;
      {%- else -%}
        {# none: 不设置 aspect-ratio #}
    {%- endcase -%}
  {%- endif -%}
{%- endcapture -%}

{%- capture pro_glow_style -%}
  {%- if settings.outer_glow_enabled -%}
    box-shadow: 0 0 {{ settings.outer_glow_blur | default: 20 }}px {{ settings.outer_glow_spread | default: 0 }}px {{ settings.outer_glow_color | default: '#00000033' }};
  {%- endif -%}
{%- endcapture -%}

{%- assign pro_position_style_stripped = pro_position_style | strip -%}
{%- assign pro_size_style_stripped = pro_size_style | strip -%}
{%- assign pro_glow_style_stripped = pro_glow_style | strip -%}

<div
  class="
    group-block
    group-block--pro
    group-block--height-{{ settings.height }}
    group-block--width-{{ settings.width }}
    border-style
    spacing-style
    size-style
    {% if settings.inherit_color_scheme == false %} color-{{ settings.color_scheme }}{% endif %}
    {{ class }}
  "
  style="
    {% render 'border-override', settings: settings %}
    {% render 'spacing-style', settings: settings %}
    {% render 'size-style', settings: settings %}
    {{ pro_position_style_stripped }}
    {{ pro_size_style_stripped }}
    {{ pro_glow_style_stripped }}
    {{ style }}
  "
  {{ shopify_attributes }}
  data-testid="group-pro-block"
>
  {%- if settings.link != blank -%}
    <a
      href="{{ settings.link }}"
      class="group-block__link"
      {% if settings.open_in_new_tab %}
        target="_blank" rel="noopener"
      {% endif %}
    ></a>
  {%- endif -%}

  <div class="group-block__media-wrapper">
    {% render 'background-media',
      background_media: settings.background_media,
      background_video: settings.video,
      background_video_position: settings.video_position,
      background_image: settings.background_image,
      background_image_position: settings.background_image_position,
      placeholder: settings.placeholder
    %}
    {% if settings.toggle_overlay %}
      {% render 'overlay', settings: settings, layer: '0' %}
    {% endif %}
  </div>

  <div
    class="
      group-block-content
      {% if request.design_mode %}group-block-content--design-mode{% endif %}
      layout-panel-flex
      layout-panel-flex--{{ settings.content_direction | default: 'column' }}
      {% if settings.vertical_on_mobile %} mobile-column{% endif %}
    "
    style="{% render 'layout-panel-style', settings: settings %}"
  >
    {{- children -}}
  </div>
</div>

{% stylesheet %}
  .group-block__link {
    position: absolute;
    inset: 0;
  }

  .group-block__link ~ :is(.group-block-content, .group-block__media-wrapper) {
    pointer-events: none;

    :is(a, button, input, textarea, select) {
      pointer-events: auto;
    }
  }

  /* Needs the .group-block__link ~ to be specific enough to take effect. */
  .group-block__link ~ .group-block-content--design-mode {
    pointer-events: auto;
  }
{% endstylesheet %}
