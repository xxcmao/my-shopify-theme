{% comment %}
  Lifestyle carousel — vLC-2.0.1
  - 每个 slide = 一个 block（建议使用 Group / Group pro）
  - 只保留圆点 + 左右箭头导航
  - 导航条整体 absolute 居中，支持宽度 / 大小 / 纵向位置控制
  - 使用 transform + transition 滑动切换
  - 导航样式使用 HexClad 原始金色圆点 + 金色 SVG 箭头
{% endcomment %}

{% liquid
  assign slide_count = section.blocks.size
%}

<div class="section-background color-{{ section.settings.color_scheme }}"></div>

<div
  class="
    section
    section--{{ section.settings.section_width }}
    color-{{ section.settings.color_scheme }}
    section-lifestyle-carousel
    spacing-style
    gap-style
  "
  style="
    {% render 'spacing-style', settings: section.settings %}
    {% render 'gap-style', value: section.settings.gap %}
  "
>
  {% if slide_count > 0 %}
    <div
      class="lifestyle-carousel"
      data-lifestyle-carousel-root
    >
      <div class="lifestyle-carousel__viewport">
        <div
          class="lifestyle-carousel__track"
          data-lifestyle-carousel-track
        >
          {% for block in section.blocks %}
            <article
              class="lifestyle-carousel__slide"
              data-lifestyle-carousel-slide
              {{ block.shopify_attributes }}
            >
              {% render block %}
            </article>
          {% endfor %}
        </div>
      </div>

      {% liquid
        assign nav_width            = section.settings.nav_width             | default: 60
        assign nav_scale_percent    = section.settings.nav_scale             | default: 100
        assign nav_scale_factor     = nav_scale_percent | times: 0.01
        assign nav_vertical         = section.settings.nav_vertical_position | default: 85
      %}

      <div
        class="lifestyle-carousel__nav"
        style="
          width: {{ nav_width }}%;
          top: {{ nav_vertical }}%;
          left: 50%;
          transform: translateX(-50%) scale({{ nav_scale_factor }});
        "
      >
        {%- comment -%} 左箭头：HexClad 原始 SVG {%- endcomment -%}
        <button
          type="button"
          class="lifestyle-carousel__arrow lifestyle-carousel__arrow--prev"
          data-lifestyle-carousel-prev
          aria-label="Previous slide"
        >
          <div class="lifestyle-carousel__arrow-iconPlaceholder">
            <svg width="12" height="20" viewBox="0 0 12 20" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M2.53964 9.99983L11.0398 1.32496L9.5502 0.293945L0.0397949 9.99983L9.5502 19.7057L11.0398 18.6747L2.53964 9.99983Z" fill="#AF9963"></path>
            </svg>
          </div>
        </button>

        <div class="lifestyle-carousel__dots">
          {% for block in section.blocks %}
            <button
              type="button"
              class="lifestyle-carousel__dot{% if forloop.first %} is-active{% endif %}"
              data-lifestyle-carousel-dot
              data-index="{{ forloop.index0 }}"
              aria-label="Go to slide {{ forloop.index }}"
            ></button>
          {% endfor %}
        </div>

        {%- comment -%} 右箭头：HexClad 原始 SVG {%- endcomment -%}
        <button
          type="button"
          class="lifestyle-carousel__arrow lifestyle-carousel__arrow--next"
          data-lifestyle-carousel-next
          aria-label="Next slide"
        >
          <div class="lifestyle-carousel__arrow-iconPlaceholder">
            <svg width="13" height="22" viewBox="0 0 13 22" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M9.30476 10.6986L0.0318604 1.23509L1.65687 0.110352L12.0319 10.6986L1.65687 21.2868L0.0318604 20.1621L9.30476 10.6986Z" fill="#AF9963"></path>
            </svg>
          </div>
        </button>
      </div>
    </div>
  {% else %}
    <div class="lifestyle-carousel__empty">
      Add a Group or Group pro block to create your first slide.
    </div>
  {% endif %}
</div>

{% stylesheet %}
  .section-lifestyle-carousel .lifestyle-carousel {
    position: relative;
  }

  .section-lifestyle-carousel .lifestyle-carousel__viewport {
    overflow: hidden;
  }

  .section-lifestyle-carousel .lifestyle-carousel__track {
    display: flex;
    transition: transform 400ms ease;
    will-change: transform;
  }

  .section-lifestyle-carousel .lifestyle-carousel__slide {
    flex: 0 0 100%;
  }

  /* 导航整体：absolute 居中，颜色金色 */
  .section-lifestyle-carousel .lifestyle-carousel__nav {
    position: absolute;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    pointer-events: auto;
    color: #AF9963;
  }

  .section-lifestyle-carousel .lifestyle-carousel__dots {
    display: flex;
    gap: 0.5rem;
  }

  /* 圆点：完全复刻 HexClad swiper-pagination-bullet */
  .section-lifestyle-carousel .lifestyle-carousel__dot {
    cursor: pointer;
    opacity: 1;
    background-color: transparent;
    border: 1px solid #AF9963;
    width: 1.25rem;
    height: 1.25rem;
    border-radius: 999px;
  }

  .section-lifestyle-carousel .lifestyle-carousel__dot.is-active {
    background-color: #AF9963;
  }

  /* 箭头按钮容器：尺寸和原站一致 */
  .section-lifestyle-carousel .lifestyle-carousel__arrow {
    border: 0;
    width: 1.875rem;
    height: 1.875rem;
    margin-top: 0;
    position: static;
    background: transparent;
    cursor: pointer;
    padding: 0;
  }

  .section-lifestyle-carousel .lifestyle-carousel__arrow-iconPlaceholder {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .section-lifestyle-carousel .lifestyle-carousel__arrow-iconPlaceholder svg {
    width: 1.25rem;
    height: 1.25rem;
    margin: 0;
    padding: 0;
    position: absolute;
    top: 50%;
    left: 50%;
    overflow: hidden;
    transform: translate(-50%, -50%);
  }

  .section-lifestyle-carousel .lifestyle-carousel__empty {
    text-align: center;
    padding: 2rem 0;
    opacity: 0.7;
  }
{% endstylesheet %}

<script>
  (function() {
    const initLifestyleCarousel = (root) => {
      if (!root) return;

      const track  = root.querySelector('[data-lifestyle-carousel-track]');
      const slides = track ? track.querySelectorAll('[data-lifestyle-carousel-slide]') : [];
      const dots   = root.querySelectorAll('[data-lifestyle-carousel-dot]');
      const prev   = root.querySelector('[data-lifestyle-carousel-prev]');
      const next   = root.querySelector('[data-lifestyle-carousel-next]');

      if (!track || !slides.length) return;

      let index = 0;
      const lastIndex = slides.length - 1;

      const update = () => {
        track.style.transform = 'translateX(' + (-index * 100) + '%)';
        dots.forEach((dot, i) => {
          dot.classList.toggle('is-active', i === index);
        });
      };

      dots.forEach((dot) => {
        const target = Number(dot.getAttribute('data-index')) || 0;
        dot.addEventListener('click', () => {
          index = target;
          update();
        });
      });

      if (prev) {
        prev.addEventListener('click', () => {
          index = index > 0 ? index - 1 : lastIndex;
          update();
        });
      }

      if (next) {
        next.addEventListener('click', () => {
          index = index < lastIndex ? index + 1 : 0;
          update();
        });
      }

      update();
    };

    const initAll = () => {
      document
        .querySelectorAll('[data-lifestyle-carousel-root]')
        .forEach(initLifestyleCarousel);
    };

    document.addEventListener('DOMContentLoaded', initAll);

    document.addEventListener('shopify:section:load', function(event) {
      const root = event.target.querySelector('[data-lifestyle-carousel-root]');
      if (root) initLifestyleCarousel(root);
    });
  })();
</script>

{% schema %}
{
  "name": "Lifestyle carousel",
  "class": "section-lifestyle-carousel",
  "max_blocks": 16,
  "blocks": [
    {
      "type": "@theme"
    },
    {
      "type": "@app"
    }
  ],
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "header",
      "content": "Section layout"
    },
    {
      "type": "select",
      "id": "section_width",
      "label": "t:settings.width",
      "options": [
        {
          "value": "page-width",
          "label": "t:options.page"
        },
        {
          "value": "full-width",
          "label": "t:options.full"
        }
      ],
      "default": "page-width"
    },
    {
      "type": "range",
      "id": "gap",
      "label": "t:settings.gap",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 28
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:settings.color_scheme",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "Navigation (dots & arrows)"
    },
    {
      "type": "range",
      "id": "nav_width",
      "label": "Navigation width",
      "min": 20,
      "max": 100,
      "step": 5,
      "unit": "%",
      "default": 60
    },
    {
      "type": "range",
      "id": "nav_scale",
      "label": "Navigation size",
      "min": 50,
      "max": 150,
      "step": 10,
      "unit": "%",
      "default": 100
    },
    {
      "type": "range",
      "id": "nav_vertical_position",
      "label": "Navigation vertical position",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "%",
      "default": 85
    },
    {
      "type": "header",
      "content": "t:content.padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "t:settings.top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 48
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "t:settings.bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 48
    }
  ],
  "presets": [
    {
      "name": "Lifestyle carousel",
      "category": "t:categories.layout",
      "blocks": [
        {
          "type": "group-pro"
        }
      ]
    }
  ]
}
{% endschema %}
